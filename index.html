<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Neuro Lung</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-900 text-white">
    <div class="flex flex-col items-center justify-center min-h-screen p-4">
      <div class="w-full max-w-2xl">
        <div class="text-center mb-8">
          <h1 class="text-5xl font-bold">
            ü´Å Neuro Lung
          </h1>
          <p class="text-gray-400 mt-2">
            Intelligent Detection of Lung Malignancies from Radiographic Images
          </p>
        </div>
        <div class="bg-gray-800 border border-gray-700 rounded-lg p-6 text-center">
          
          <input class="hidden" id="file-upload" type="file" accept="image/png, image/jpeg, image/jpg" />
          
          <button id="upload-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg cursor-pointer">
            Upload a CT Scan Image
          </button>
          
          <p class="text-xs text-gray-500 mt-2">
            PNG, JPG, JPEG up to 10MB
          </p>

          <div id="image-preview-container" class="mt-6" style="display: none;">
            <h3 class="font-semibold text-lg mb-2">Uploaded Scan:</h3>
            <img id="image-preview" class="max-w-xs mx-auto rounded-lg" alt="Image Preview"/>
          </div>

          <div id="loader" class="mt-6" style="display: none;">
            <svg class="animate-spin h-8 w-8 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="text-gray-400 mt-2">Analyzing...</p>
          </div>

          <div id="result-container" class="mt-6 p-4 rounded-lg" style="display: none;">
            <h3 class="font-bold text-2xl" id="result-title"></h3>
            <p class="text-lg" id="result-message"></p>
          </div>

        </div>
      </div>
    </div>

    <script>
      const uploadButton = document.getElementById('upload-button');
      const fileUpload = document.getElementById('file-upload');
      
      const imagePreviewContainer = document.getElementById('image-preview-container');
      const imagePreview = document.getElementById('image-preview');

      const loader = document.getElementById('loader');
      const resultContainer = document.getElementById('result-container');
      const resultTitle = document.getElementById('result-title');
      const resultMessage = document.getElementById('result-message');

      uploadButton.addEventListener('click', () => {
        fileUpload.click();
      });

      fileUpload.addEventListener('change', async (event) => {
        const file = event.target.files[0];
        if (!file) return;

        resultContainer.style.display = 'none';
        imagePreviewContainer.style.display = 'block';
        loader.style.display = 'block';

        const reader = new FileReader();
        reader.onload = (e) => {
            imagePreview.src = e.target.result;
        };
        reader.readAsDataURL(file);

        const formData = new FormData();
        formData.append('file', file);

        try {
          const response = await fetch('http://127.0.0.1:5000/predict', {
            method: 'POST',
            body: formData,
          });

          if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);

          const data = await response.json();
          displayResult(data);

        } catch (error) {
          console.error('Error:', error);
          displayResult({ prediction: 'Error', error: 'Could not get a prediction. Please check the backend.' });
        } finally {
          loader.style.display = 'none';
        }
      });

      function displayResult(data) {
          resultContainer.classList.remove('bg-green-900', 'bg-yellow-900', 'bg-red-900', 'border-green-500', 'border-yellow-500', 'border-red-500');
          resultContainer.style.border = '1px solid'; // Add border style

          if (data.prediction === 'Normal') {
              resultContainer.classList.add('bg-green-900', 'border-green-500');
              resultTitle.textContent = '‚úÖ No Lung Cancer Detected';
              resultMessage.textContent = 'The analysis did not find evidence of malignancies.';
          } else if (data.prediction === 'Benign') {
              resultContainer.classList.add('bg-yellow-900', 'border-yellow-500');
              resultTitle.textContent = '‚ö†Ô∏è Lung Cancer Detected: Benign Tumor';
              resultMessage.textContent = 'The tumor is non-cancerous. Further consultation is still recommended.';
          } else if (data.prediction === 'Malignant') {
              resultContainer.classList.add('bg-red-900', 'border-red-500');
              resultTitle.textContent = '‚ùó Lung Cancer Detected: Malignant Tumor';
              resultMessage.textContent = 'The tumor appears to be cancerous. Please consult a medical professional immediately.';
          } else {
              resultContainer.classList.add('bg-gray-700', 'border-gray-500');
              resultTitle.textContent = '‚ùå Analysis Error';
              resultMessage.textContent = data.error || 'An unknown error occurred.';
          }
          
          resultContainer.style.display = 'block';
      }
    </script>
  </body>
</html>